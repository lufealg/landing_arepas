---
// src/components/Cart.astro
---
<div id="cart-container" class="fixed bottom-5 right-5 z-50">
  <!-- Botón flotante del carrito -->
  <button id="cart-button" class="bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 transition-colors">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
    </svg>
    <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
  </button>

  <!-- Panel del carrito (inicialmente oculto) -->
  <div id="cart-panel" class="hidden absolute bottom-16 right-0 w-80 bg-white rounded-lg shadow-2xl border border-gray-200">
    <div class="p-4 border-b">
      <h2 class="text-xl font-bold">Tu Carrito</h2>
    </div>
    <div id="cart-items" class="p-4 h-64 overflow-y-auto">
      <!-- Los productos del carrito se insertarán aquí -->
      <p class="text-gray-500">Tu carrito está vacío.</p>
    </div>
    <div class="p-4 border-t">
      <div class="flex justify-between font-bold">
        <span>Total</span>
        <span id="cart-total">$0.00</span>
      </div>
      <button class="w-full bg-green-500 text-white py-2 mt-4 rounded-lg hover:bg-green-600">
        Finalizar Compra
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('astro:page-load', () => {
    const cartButton = document.getElementById('cart-button');
    const cartPanel = document.getElementById('cart-panel');

    // Mostrar/ocultar panel del carrito
    cartButton.addEventListener('click', () => {
      cartPanel.classList.toggle('hidden');
    });

    // Función para actualizar la vista del carrito
    function updateCartView() {
      const cartItemsContainer = document.getElementById('cart-items');
      const cartCount = document.getElementById('cart-count');
      const cartTotal = document.getElementById('cart-total');
      
      const cart = JSON.parse(localStorage.getItem('cart')) || [];

      cartCount.textContent = cart.reduce((acc, item) => acc + item.quantity, 0).toString();

      if (cart.length === 0) {
        cartItemsContainer.innerHTML = '<p class="text-gray-500">Tu carrito está vacío.</p>';
        cartTotal.textContent = '$0.00';
        return;
      }

      cartItemsContainer.innerHTML = ''; // Limpiar vista
      let total = 0;

      cart.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'flex justify-between items-center mb-2';
        itemElement.innerHTML = `
          <div>
            <p class="font-bold">${item.name}</p>
            <p class="text-sm text-gray-600">${item.quantity} x $${item.price.toFixed(2)}</p>
          </div>
          <span>$${(item.quantity * item.price).toFixed(2)}</span>
        `;
        cartItemsContainer.appendChild(itemElement);
        total += item.quantity * item.price;
      });

      cartTotal.textContent = `$${total.toFixed(2)}`;
    }

    // Escuchar por cambios en el carrito desde otras partes de la app
    window.addEventListener('cartUpdated', () => {
      updateCartView();
    });

    // Cargar el estado inicial del carrito
    updateCartView();
  });
</script>
